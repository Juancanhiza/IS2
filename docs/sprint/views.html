<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>views.py</title>
  <link rel="stylesheet" href="../pycco.css">
</head>
<body>
<div id='container'>
  <div id="background"></div>
  <div class='section'>
    <div class='docs'><h1>views.py</h1></div>
  </div>
  <div class='clearall'>
  <div class='section' id='section-0'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-0'>#</a>
      </div>
      <p>Vista del Login</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">ListView</span><span class="p">,</span> <span class="n">CreateView</span><span class="p">,</span> <span class="n">UpdateView</span><span class="p">,</span> <span class="n">DetailView</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponseRedirect</span>
<span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">proyecto.models</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">sprint.forms</span> <span class="kn">import</span> <span class="n">CreateSprintForm</span><span class="p">,</span> <span class="n">UpdateSprintForm</span>
<span class="kn">from</span> <span class="nn">django.contrib.messages.views</span> <span class="kn">import</span> <span class="n">SuccessMessageMixin</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.decorators</span> <span class="kn">import</span> <span class="n">login_required</span>
<span class="kn">from</span> <span class="nn">django.utils.decorators</span> <span class="kn">import</span> <span class="n">method_decorator</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.mixins</span> <span class="kn">import</span> <span class="n">LoginRequiredMixin</span>
<span class="kn">from</span> <span class="nn">userstory.models</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">flujo.models</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">django.forms</span> <span class="kn">import</span> <span class="n">inlineformset_factory</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">transaction</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">django.template.loader</span> <span class="kn">import</span> <span class="n">render_to_string</span>
<span class="kn">from</span> <span class="nn">django.core.mail</span> <span class="kn">import</span> <span class="n">EmailMessage</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-1'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-1'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-2'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-2'>#</a>
      </div>
      <p>Vista de la lista de todos los Sprints del proyecto</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="nd">@method_decorator</span><span class="p">(</span><span class="n">login_required</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;dispatch&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">SprintListView</span><span class="p">(</span><span class="n">LoginRequiredMixin</span><span class="p">,</span> <span class="n">ListView</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-3'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-3'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">&#39;sprint/list.html&#39;</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Sprint</span>
    <span class="n">queryset</span> <span class="o">=</span> <span class="n">Sprint</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-4'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-4'>#</a>
      </div>
      <p>Metodo que retorna un diccionario utilizado para pasar datos a las vistas
:param kwargs: Diccionario de datos adicionales para el contexto
:return: diccionario de contexto necesario para la correcta visualizacion de los datos</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-5'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-5'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Sprints de Proyecto&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">context</span><span class="p">[</span><span class="s1">&#39;sprint_pendiente&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Sprint</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">proyecto</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;pk_proyecto&#39;</span><span class="p">],</span><span class="n">estado</span><span class="o">=</span><span class="s1">&#39;Pendiente&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;direccion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;direccion&#39;</span><span class="p">][</span><span class="s1">&#39;Ejecuciones&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;/proyectos/ejecuciones/&#39;</span><span class="p">)</span>
        <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;pk_proyecto&#39;</span><span class="p">])</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;direccion&#39;</span><span class="p">][</span><span class="n">proyecto</span><span class="o">.</span><span class="n">nombre</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;/proyectos/ejecuciones/&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">proyecto</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;direccion&#39;</span><span class="p">][</span><span class="s1">&#39;Sprints&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;/proyectos/ejecuciones/&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">proyecto</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/sprints/&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">context</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-6'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-6'>#</a>
      </div>
      <p>Metodo que es ejecutado al darse una consulta GET
:param request: consulta recibida
:param args: argumentos adicionales
:param kwargs: diccionario de datos adicionales
:return: la respuesta a la consulta GET</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">request</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-7'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-7'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">object_list</span> <span class="o">=</span> <span class="n">Sprint</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">proyecto</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;pk_proyecto&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;-pk&#39;</span><span class="p">)</span>
        <span class="n">permisos</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">get_nombres_permisos</span><span class="p">(</span><span class="n">proyecto</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;pk_proyecto&#39;</span><span class="p">])</span>
        <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;pk_proyecto&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_to_response</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="n">proyecto</span><span class="p">,</span> <span class="n">object_list</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">object_list</span><span class="p">,</span><span class="n">permisos</span><span class="o">=</span><span class="n">permisos</span><span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-8'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-8'>#</a>
      </div>
      <p>Vista para la creacion de un Sprint</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="nd">@method_decorator</span><span class="p">(</span><span class="n">login_required</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;dispatch&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">CreateSprintView</span><span class="p">(</span><span class="n">SuccessMessageMixin</span><span class="p">,</span> <span class="n">LoginRequiredMixin</span><span class="p">,</span> <span class="n">CreateView</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-9'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-9'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">&#39;sprint/sprint.html&#39;</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Sprint</span>
    <span class="n">success_url</span> <span class="o">=</span> <span class="s1">&#39;../../&#39;</span>
    <span class="n">form_class</span> <span class="o">=</span> <span class="n">CreateSprintForm</span>
    <span class="n">success_message</span> <span class="o">=</span> <span class="s1">&#39;Se ha creado el sprint&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-10'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-10'>#</a>
      </div>
      <p>Metodo que retorna el objeto a ser creado con el proyecto actual asignado
:param queryset:
:return: el objeto actual con el proyecto seleccionado pre-asignado</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">get_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">queryset</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-11'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-11'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">obj</span> <span class="o">=</span> <span class="n">Sprint</span><span class="p">()</span>
        <span class="n">proyecto</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;pk_proyecto&#39;</span><span class="p">])</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">proyecto</span> <span class="o">=</span> <span class="n">proyecto</span>
        <span class="k">return</span> <span class="n">obj</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-12'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-12'>#</a>
      </div>
      <p>Metodo que es ejecutado al darse una consulta GET
:param request: consulta recibida
:param args: argumentos adicionales
:param kwargs: diccionario de datos adicionales
:return: la respuesta a la consulta GET</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">request</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-13'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-13'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span>
        <span class="n">form_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_form_class</span><span class="p">()</span>
        <span class="n">form</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_form</span><span class="p">(</span><span class="n">form_class</span><span class="p">)</span>
        <span class="n">permisos</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">get_nombres_permisos</span><span class="p">(</span><span class="n">proyecto</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;pk_proyecto&#39;</span><span class="p">])</span>
        <span class="n">team</span> <span class="o">=</span> <span class="n">TeamMember</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">proyecto</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;pk_proyecto&#39;</span><span class="p">])</span>
        <span class="n">DiasLaboralesFormSet</span> <span class="o">=</span> <span class="n">inlineformset_factory</span><span class="p">(</span><span class="n">Sprint</span><span class="p">,</span> <span class="n">Horas</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">HorasForm</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">team</span><span class="p">))</span>
        <span class="n">horas_team</span> <span class="o">=</span> <span class="n">DiasLaboralesFormSet</span><span class="p">()</span>
        <span class="n">form_nr</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">formularios</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">tm</span> <span class="ow">in</span> <span class="n">team</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">horas_team</span><span class="p">[</span><span class="n">form_nr</span><span class="p">]</span>
            <span class="n">f</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;team_member&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">initial</span> <span class="o">=</span> <span class="n">tm</span><span class="o">.</span><span class="n">usuario</span><span class="o">.</span><span class="n">pk</span>
            <span class="k">if</span> <span class="n">tm</span><span class="o">.</span><span class="n">usuario</span><span class="o">.</span><span class="n">pk</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">formularios</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">formularios</span><span class="p">[</span><span class="n">tm</span><span class="o">.</span><span class="n">usuario</span><span class="o">.</span><span class="n">pk</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">formularios</span><span class="p">[</span><span class="n">tm</span><span class="o">.</span><span class="n">usuario</span><span class="o">.</span><span class="n">pk</span><span class="p">][</span><span class="s1">&#39;usuario&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tm</span><span class="o">.</span><span class="n">usuario</span><span class="o">.</span><span class="n">username</span>
            <span class="n">formularios</span><span class="p">[</span><span class="n">tm</span><span class="o">.</span><span class="n">usuario</span><span class="o">.</span><span class="n">pk</span><span class="p">][</span><span class="s1">&#39;formulario&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span>
            <span class="n">form_nr</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_to_response</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="n">team</span><span class="o">=</span><span class="n">team</span><span class="p">,</span> <span class="n">horas_formset</span><span class="o">=</span><span class="n">horas_team</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">,</span>
                                                             <span class="n">permisos</span><span class="o">=</span><span class="n">permisos</span><span class="p">,</span> <span class="n">formularios</span><span class="o">=</span><span class="n">formularios</span><span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-14'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-14'>#</a>
      </div>
      <p>Metodo que es ejecutado al darse una consulta POST
:param request: consulta recibida
:param args: argumentos adicionales
:param kwargs: diccionario de datos adicionales
:return: la respuesta a la consulta POST</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-15'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-15'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">dias_habiles</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s1">&#39;dias_habiles&#39;</span><span class="p">))[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">dias_habiles</span> <span class="o">=</span> <span class="n">dias_habiles</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">permisos</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">get_nombres_permisos</span><span class="p">(</span><span class="n">proyecto</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;pk_proyecto&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span>
        <span class="n">formclass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_form_class</span><span class="p">()</span>
        <span class="n">form</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_form</span><span class="p">(</span><span class="n">formclass</span><span class="p">)</span>
        <span class="n">team</span> <span class="o">=</span> <span class="n">TeamMember</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">proyecto</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;pk_proyecto&#39;</span><span class="p">])</span>
        <span class="n">horas_team</span> <span class="o">=</span> <span class="n">HorasFormSet</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">()</span> <span class="ow">and</span> <span class="n">horas_team</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">transaction</span><span class="o">.</span><span class="n">atomic</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
                    <span class="n">horas_team</span><span class="o">.</span><span class="n">instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span>
                    <span class="n">Horas</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">sprint</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
                    <span class="n">horas_team</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                    <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">success_url</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">form_error</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">message</span>
                <span class="n">formularios</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="kn">from</span> <span class="nn">usuarios.models</span> <span class="kn">import</span> <span class="n">Usuario</span>
                <span class="k">for</span> <span class="n">ht</span> <span class="ow">in</span> <span class="n">horas_team</span><span class="p">:</span>
                    <span class="n">usuario</span> <span class="o">=</span> <span class="n">Usuario</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">ht</span><span class="p">[</span><span class="s1">&#39;team_member&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>
                    <span class="k">if</span> <span class="n">usuario</span><span class="o">.</span><span class="n">pk</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">formularios</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">formularios</span><span class="p">[</span><span class="n">usuario</span><span class="o">.</span><span class="n">pk</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="n">formularios</span><span class="p">[</span><span class="n">usuario</span><span class="o">.</span><span class="n">pk</span><span class="p">][</span><span class="s1">&#39;usuario&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">username</span>
                    <span class="n">formularios</span><span class="p">[</span><span class="n">usuario</span><span class="o">.</span><span class="n">pk</span><span class="p">][</span><span class="s1">&#39;formulario&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ht</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_to_response</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="n">team</span><span class="o">=</span><span class="n">team</span><span class="p">,</span> <span class="n">horas_formset</span><span class="o">=</span><span class="n">horas_team</span><span class="p">,</span>
                                                                     <span class="n">permisos</span><span class="o">=</span><span class="n">permisos</span><span class="p">,</span> <span class="n">formularios</span><span class="o">=</span><span class="n">formularios</span><span class="p">,</span>
                                                                     <span class="n">form_error</span><span class="o">=</span><span class="n">form_error</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">formularios</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="kn">from</span> <span class="nn">usuarios.models</span> <span class="kn">import</span> <span class="n">Usuario</span>
            <span class="k">for</span> <span class="n">ht</span> <span class="ow">in</span> <span class="n">horas_team</span><span class="p">:</span>
                <span class="n">usuario</span> <span class="o">=</span> <span class="n">Usuario</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">ht</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s1">&#39;team_member&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">usuario</span><span class="o">.</span><span class="n">pk</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">formularios</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">formularios</span><span class="p">[</span><span class="n">usuario</span><span class="o">.</span><span class="n">pk</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">usuario</span> <span class="o">=</span> <span class="n">Usuario</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">ht</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">])</span>
                <span class="n">formularios</span><span class="p">[</span><span class="n">usuario</span><span class="o">.</span><span class="n">pk</span><span class="p">][</span><span class="s1">&#39;usuario&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">username</span>
                <span class="n">formularios</span><span class="p">[</span><span class="n">usuario</span><span class="o">.</span><span class="n">pk</span><span class="p">][</span><span class="s1">&#39;formulario&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ht</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_to_response</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="n">team</span><span class="o">=</span><span class="n">team</span><span class="p">,</span> <span class="n">horas_formset</span><span class="o">=</span><span class="n">horas_team</span><span class="p">,</span>
                                                                 <span class="n">permisos</span><span class="o">=</span><span class="n">permisos</span><span class="p">,</span> <span class="n">formularios</span><span class="o">=</span><span class="n">formularios</span><span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-16'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-16'>#</a>
      </div>
      <p>Metodo que retorna un diccionario utilizado para pasar datos a las vistas
:param kwargs: Diccionario de datos adicionales para el contexto
:return: diccionario de contexto necesario para la correcta visualizacion de los datos</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-17'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-17'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">tm_disponibles</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;tm_disponibles&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">tm_disponibles</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Crear Sprint&quot;</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;project&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;pk_proyecto&#39;</span><span class="p">])</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;obs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Los sprints se crean por defecto en estado Pendiente, deben iniciarse manualmente&quot;</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;direccion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;direccion&#39;</span><span class="p">][</span><span class="s1">&#39;Ejecuciones&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;/proyectos/ejecuciones/&#39;</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;direccion&#39;</span><span class="p">][</span><span class="nb">str</span><span class="p">(</span><span class="n">context</span><span class="p">[</span><span class="s1">&#39;project&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;/proyectos/ejecuciones/&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;pk_proyecto&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;direccion&#39;</span><span class="p">][</span><span class="s1">&#39;Sprints&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;/proyectos/ejecuciones/&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;pk_proyecto&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;/sprints/&#39;</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;direccion&#39;</span><span class="p">][</span><span class="s1">&#39;Crear&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;/proyectos/ejecuciones/&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;pk_proyecto&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;/sprints/create/&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">context</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-18'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-18'>#</a>
      </div>
      <p>Vista para la modificacion de un Sprint</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="nd">@method_decorator</span><span class="p">(</span><span class="n">login_required</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;dispatch&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">UpdateSprintView</span><span class="p">(</span><span class="n">LoginRequiredMixin</span><span class="p">,</span> <span class="n">SuccessMessageMixin</span><span class="p">,</span> <span class="n">UpdateView</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-19'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-19'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">&#39;sprint/sprint.html&#39;</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Sprint</span>
    <span class="n">form_class</span> <span class="o">=</span> <span class="n">UpdateSprintForm</span>
    <span class="n">success_url</span> <span class="o">=</span> <span class="s1">&#39;../../&#39;</span>
    <span class="n">success_message</span> <span class="o">=</span> <span class="s1">&#39;Los cambios se guardaron correctamente&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-20'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-20'>#</a>
      </div>
      <p>Metodo que es ejecutado al darse una consulta GET
:param request: consulta recibida
:param args: argumentos adicionales
:param kwargs: diccionario de datos adicionales
:return: la respuesta a la consulta GET</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-21'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-21'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span>
        <span class="n">permisos</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">get_nombres_permisos</span><span class="p">(</span><span class="n">proyecto</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;pk_proyecto&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_to_response</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="n">permisos</span><span class="o">=</span><span class="n">permisos</span><span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-22'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-22'>#</a>
      </div>
      <p>Metodo que retorna un diccionario utilizado para pasar datos a las vistas
:param kwargs: Diccionario de datos adicionales para el contexto
:return: diccionario de contexto necesario para la correcta visualizacion de los datos</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-23'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-23'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Modificar Sprint&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;project&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Proyecto</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;pk_proyecto&#39;</span><span class="p">])</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;dias_habiles&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">get_dias_habiles</span><span class="p">()</span>
        <span class="n">horas_asignadas</span> <span class="o">=</span> <span class="n">Horas</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">sprint</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
        <span class="n">tm_asignados</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">tm</span> <span class="ow">in</span> <span class="n">horas_asignadas</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tm</span><span class="o">.</span><span class="n">team_member</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tm_asignados</span><span class="p">:</span>
                <span class="n">tm_asignados</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tm</span><span class="o">.</span><span class="n">team_member</span><span class="p">)</span>
        <span class="n">all_tm</span> <span class="o">=</span> <span class="n">TeamMember</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">proyecto</span><span class="o">=</span><span class="n">context</span><span class="p">[</span><span class="s1">&#39;project&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
        <span class="n">tm_disponibles</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">tm</span> <span class="ow">in</span> <span class="n">all_tm</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tm</span><span class="o">.</span><span class="n">usuario</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tm_asignados</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="n">tm</span><span class="o">.</span><span class="n">usuario</span><span class="o">.</span><span class="n">username</span><span class="p">,</span>
                        <span class="s1">&#39;user_pk&#39;</span><span class="p">:</span> <span class="n">tm</span><span class="o">.</span><span class="n">usuario</span><span class="o">.</span><span class="n">pk</span><span class="p">}</span>
                <span class="n">tm_disponibles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;tm_disponibles&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">tm_disponibles</span><span class="p">)</span>
        <span class="n">team_members</span> <span class="o">=</span> <span class="n">Horas</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">sprint</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="p">)</span>
        <span class="n">horas_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">team_actual</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">tm</span> <span class="ow">in</span> <span class="n">team_members</span><span class="p">:</span>
            <span class="n">usuario</span> <span class="o">=</span> <span class="n">Usuario</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">tm</span><span class="o">.</span><span class="n">team_member</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
            <span class="n">h</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;team_member&#39;</span><span class="p">:</span> <span class="n">tm</span><span class="o">.</span><span class="n">team_member</span><span class="p">,</span>
                 <span class="s1">&#39;horas_laborales&#39;</span><span class="p">:</span> <span class="n">tm</span><span class="o">.</span><span class="n">horas_laborales</span><span class="p">}</span>
            <span class="n">team_actual</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">usuario</span><span class="p">)</span>
            <span class="n">horas_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
        <span class="n">TeamMemberFormSet</span> <span class="o">=</span> <span class="n">inlineformset_factory</span><span class="p">(</span><span class="n">Sprint</span><span class="p">,</span> <span class="n">Horas</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">HorasForm</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">horas_data</span><span class="p">))</span>
        <span class="n">horas_formset</span> <span class="o">=</span> <span class="n">TeamMemberFormSet</span><span class="p">(</span><span class="n">initial</span><span class="o">=</span><span class="n">horas_data</span><span class="p">)</span>
        <span class="n">formularios</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">formularios</span><span class="p">[</span><span class="s1">&#39;formularios&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">readonly</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">estado</span> <span class="o">!=</span> <span class="s1">&#39;Pendiente&#39;</span><span class="p">:</span>
            <span class="n">readonly</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">for</span> <span class="n">tm</span> <span class="ow">in</span> <span class="n">horas_formset</span><span class="p">:</span>
            <span class="n">tm</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;horas_laborales&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">widget</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;readonly&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">readonly</span>
            <span class="k">if</span> <span class="n">tm</span><span class="o">.</span><span class="n">get_user_id</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">formularios</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">formularios</span><span class="p">[</span><span class="n">tm</span><span class="o">.</span><span class="n">get_user_id</span><span class="p">()]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">formularios</span><span class="p">[</span><span class="n">tm</span><span class="o">.</span><span class="n">get_user_id</span><span class="p">()][</span><span class="s1">&#39;usuario&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tm</span><span class="o">.</span><span class="n">get_username</span><span class="p">()</span>
            <span class="n">formularios</span><span class="p">[</span><span class="n">tm</span><span class="o">.</span><span class="n">get_user_id</span><span class="p">()][</span><span class="s1">&#39;formulario&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tm</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;team_actual&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">team_actual</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;horas_formset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">horas_formset</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;formularios&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">formularios</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;direccion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;direccion&#39;</span><span class="p">][</span><span class="s1">&#39;Ejecuciones&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;/proyectos/ejecuciones/&#39;</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;direccion&#39;</span><span class="p">][</span><span class="nb">str</span><span class="p">(</span><span class="n">context</span><span class="p">[</span><span class="s1">&#39;project&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;/proyectos/ejecuciones/&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;pk_proyecto&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;direccion&#39;</span><span class="p">][</span><span class="s1">&#39;Sprints&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;/proyectos/ejecuciones/&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;pk_proyecto&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;/sprints/&#39;</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">&#39;direccion&#39;</span><span class="p">][</span><span class="s1">&#39;Modificar: &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">nombre</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;/proyectos/ejecuciones/&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;pk_proyecto&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;/sprints/modificar/&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">context</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-24'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-24'>#</a>
      </div>
      <p>Metodo que retorna el objeto a ser modificado
:param queryset:
:return: el objeto actual</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">get_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">queryset</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-25'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-25'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">return</span> <span class="n">Sprint</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;sprint_pk&#39;</span><span class="p">])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-26'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-26'>#</a>
      </div>
      <p>Metodo que es ejecutado al darse una consulta POST
:param request: consulta recibida
:param args: argumentos adicionales
:param kwargs: diccionario de datos adicionales
:return: la respuesta a la consulta POST</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-27'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-27'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="kn">from</span> <span class="nn">usuarios.models</span> <span class="kn">import</span> <span class="n">Usuario</span>
        <span class="n">dias_habiles</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s1">&#39;dias_habiles&#39;</span><span class="p">))[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">dias_habiles</span> <span class="o">=</span> <span class="n">dias_habiles</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">permisos</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">get_nombres_permisos</span><span class="p">(</span><span class="n">proyecto</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;pk_proyecto&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span>
        <span class="n">formclass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_form_class</span><span class="p">()</span>
        <span class="n">form</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_form</span><span class="p">(</span><span class="n">formclass</span><span class="p">)</span>
        <span class="n">team</span> <span class="o">=</span> <span class="n">TeamMember</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">proyecto</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;pk_proyecto&#39;</span><span class="p">])</span>
        <span class="n">horas_team</span> <span class="o">=</span> <span class="n">HorasFormSet</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-28'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-28'>#</a>
      </div>
      <p>Reasignacion de team members</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="s1">&#39;viejo_tm&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="s1">&#39;tm_disponibles&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">viejo_tm</span> <span class="o">=</span> <span class="n">Usuario</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s1">&#39;viejo_tm&#39;</span><span class="p">])</span>
            <span class="n">nuevo_tm</span> <span class="o">=</span> <span class="n">Usuario</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s1">&#39;tm_disponibles&#39;</span><span class="p">])</span>
            <span class="n">us_a_modificar_p</span> <span class="o">=</span> <span class="n">UserStory</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">team_member</span><span class="o">=</span><span class="n">viejo_tm</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="n">estado</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">us_a_modificar_a</span> <span class="o">=</span> <span class="n">UserStory</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">team_member</span><span class="o">=</span><span class="n">viejo_tm</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="n">estado</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-29'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-29'>#</a>
      </div>
      <p>Lista de todos los us a reasignar, enviar al usuario nuevo_tm</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">us_a_modificar</span> <span class="o">=</span> <span class="n">us_a_modificar_a</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">us_a_modificar_p</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">us</span> <span class="ow">in</span> <span class="n">us_a_modificar</span><span class="p">:</span>
                <span class="n">us</span><span class="o">.</span><span class="n">team_member</span> <span class="o">=</span> <span class="n">nuevo_tm</span>
                <span class="n">us</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">horas</span> <span class="o">=</span> <span class="n">Horas</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">sprint</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;sprint_pk&#39;</span><span class="p">],</span><span class="n">team_member</span><span class="o">=</span><span class="n">viejo_tm</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">hora</span> <span class="ow">in</span> <span class="n">horas</span><span class="p">:</span>
                <span class="n">hora</span><span class="o">.</span><span class="n">team_member</span> <span class="o">=</span> <span class="n">nuevo_tm</span>
                <span class="n">hora</span><span class="o">.</span><span class="n">save</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-30'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-30'>#</a>
      </div>
      <p>Notificación al Desarrollador por correo</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">body</span> <span class="o">=</span> <span class="n">render_to_string</span><span class="p">(</span>
                <span class="s1">&#39;../templates/notificaciones/reasignacion_us.html&#39;</span><span class="p">,</span> <span class="p">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-31'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-31'>#</a>
      </div>
      <p>Poner los parámetros requeridos del correo</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                    <span class="s1">&#39;lista_us&#39;</span><span class="p">:</span> <span class="n">us_a_modificar</span><span class="p">,</span>
                    <span class="s1">&#39;proyecto&#39;</span><span class="p">:</span> <span class="n">us</span><span class="o">.</span><span class="n">proyecto</span><span class="o">.</span><span class="n">nombre</span><span class="p">,</span>
                    <span class="s1">&#39;sprint&#39;</span><span class="p">:</span> <span class="n">us</span><span class="o">.</span><span class="n">sprint</span><span class="o">.</span><span class="n">nombre</span><span class="p">,</span>
                    <span class="s1">&#39;team_member&#39;</span><span class="p">:</span> <span class="n">nuevo_tm</span><span class="o">.</span><span class="n">first_name</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">)</span>
            <span class="n">email_msg</span> <span class="o">=</span> <span class="n">EmailMessage</span><span class="p">(</span>
                <span class="n">subject</span><span class="o">=</span><span class="s1">&#39;Asignacion de US&#39;</span><span class="p">,</span>
                <span class="n">body</span><span class="o">=</span><span class="n">body</span><span class="p">,</span>
                <span class="n">from_email</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;PoliProyectos-noreply&#39;</span><span class="p">],</span>
                <span class="n">to</span><span class="o">=</span><span class="p">[</span><span class="n">nuevo_tm</span><span class="o">.</span><span class="n">email</span><span class="p">],</span>
            <span class="p">)</span>
            <span class="n">email_msg</span><span class="o">.</span><span class="n">content_subtype</span> <span class="o">=</span> <span class="s1">&#39;html&#39;</span>
            <span class="n">email_msg</span><span class="o">.</span><span class="n">send</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">&#39;./&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-32'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-32'>#</a>
      </div>
      <p>fin reasignacion de team members</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">()</span> <span class="ow">and</span> <span class="n">horas_team</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">transaction</span><span class="o">.</span><span class="n">atomic</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
                    <span class="n">horas_team</span><span class="o">.</span><span class="n">instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span>
                    <span class="n">Horas</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">sprint</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
                    <span class="n">horas_team</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                    <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">success_url</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">form_error</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">message</span>
                <span class="n">formularios</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">ht</span> <span class="ow">in</span> <span class="n">horas_team</span><span class="p">:</span>
                    <span class="n">usuario</span> <span class="o">=</span> <span class="n">Usuario</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">ht</span><span class="p">[</span><span class="s1">&#39;team_member&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>
                    <span class="k">if</span> <span class="n">usuario</span><span class="o">.</span><span class="n">pk</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">formularios</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">formularios</span><span class="p">[</span><span class="n">usuario</span><span class="o">.</span><span class="n">pk</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="n">formularios</span><span class="p">[</span><span class="n">usuario</span><span class="o">.</span><span class="n">pk</span><span class="p">][</span><span class="s1">&#39;usuario&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">username</span>
                    <span class="n">formularios</span><span class="p">[</span><span class="n">usuario</span><span class="o">.</span><span class="n">pk</span><span class="p">][</span><span class="s1">&#39;formulario&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ht</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_to_response</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="n">team</span><span class="o">=</span><span class="n">team</span><span class="p">,</span> <span class="n">horas_formset</span><span class="o">=</span><span class="n">horas_team</span><span class="p">,</span>
                                                                     <span class="n">permisos</span><span class="o">=</span><span class="n">permisos</span><span class="p">,</span> <span class="n">formularios</span><span class="o">=</span><span class="n">formularios</span><span class="p">,</span>
                                                                     <span class="n">form_error</span><span class="o">=</span><span class="n">form_error</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">formularios</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">ht</span> <span class="ow">in</span> <span class="n">horas_team</span><span class="p">:</span>
                <span class="n">usuario</span> <span class="o">=</span> <span class="n">Usuario</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">ht</span><span class="p">[</span><span class="s1">&#39;team_member&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>
                <span class="k">if</span> <span class="n">usuario</span><span class="o">.</span><span class="n">pk</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">formularios</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">formularios</span><span class="p">[</span><span class="n">usuario</span><span class="o">.</span><span class="n">pk</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">formularios</span><span class="p">[</span><span class="n">usuario</span><span class="o">.</span><span class="n">pk</span><span class="p">][</span><span class="s1">&#39;usuario&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">usuario</span><span class="o">.</span><span class="n">username</span>
                <span class="n">formularios</span><span class="p">[</span><span class="n">usuario</span><span class="o">.</span><span class="n">pk</span><span class="p">][</span><span class="s1">&#39;formulario&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ht</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_to_response</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="n">team</span><span class="o">=</span><span class="n">team</span><span class="p">,</span> <span class="n">horas_formset</span><span class="o">=</span><span class="n">horas_team</span><span class="p">,</span>
                                                                 <span class="n">permisos</span><span class="o">=</span><span class="n">permisos</span><span class="p">,</span> <span class="n">formularios</span><span class="o">=</span><span class="n">formularios</span><span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-33'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-33'>#</a>
      </div>
      <p>Vista para la asignacion de user story</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="nd">@method_decorator</span><span class="p">(</span><span class="n">login_required</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;dispatch&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">AsignarUSUpdateView</span><span class="p">(</span><span class="n">LoginRequiredMixin</span><span class="p">,</span> <span class="n">ListView</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-34'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-34'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">&#39;sprint/asignar_us.html&#39;</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">UserStory</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-35'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-35'>#</a>
      </div>
      <p>retorna la lista de todos los user stories pendientes actualmente</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-36'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-36'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">sprint</span> <span class="o">=</span> <span class="n">Sprint</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;sprint_pk&#39;</span><span class="p">])</span>
        <span class="n">asignados</span> <span class="o">=</span> <span class="n">UserStory</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">proyecto</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;pk_proyecto&#39;</span><span class="p">],</span>
                                                <span class="n">estado</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sprint</span><span class="o">=</span><span class="n">sprint</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
        <span class="n">pendientes</span> <span class="o">=</span> <span class="n">UserStory</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">proyecto</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;pk_proyecto&#39;</span><span class="p">],</span>
                                                <span class="n">estado</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">asignados</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">pendientes</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-37'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-37'>#</a>
      </div>
      <p>retorna dos listas, primero una lista de todos los user stories pendientes</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">get_pendientes_clasificados</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sprint</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-38'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-38'>#</a>
      </div>
      <p>que ya han sido trabajados en otro sprint ordenados por priorizacion y segundo
la lista de todos los user stories pendientes que aun no han sido trabajados</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">ordenados</span> <span class="n">por</span> <span class="n">priorizacion</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        second_list_a = UserStory.objects.filter(proyecto=self.kwargs[&#39;pk_proyecto&#39;],</span>
<span class="s2">                                                    sprints_asignados=None, estado=1,</span>
<span class="s2">                                                    sprint=sprint.pk)</span>
<span class="s2">        second_list_p = UserStory.objects.filter(proyecto=self.kwargs[&#39;pk_proyecto&#39;],</span>
<span class="s2">                                                    sprints_asignados=None, estado=2)</span>
<span class="s2">        second_list = second_list_a.union(second_list_p)</span>
<span class="s2">        first_list = self.get_queryset().difference(second_list)</span>
<span class="s2">        sl = []</span>
<span class="s2">        for us in second_list:</span>
<span class="s2">            sl.append(us)</span>
<span class="s2">        sl.sort(key=lambda x: x.priorizacion, reverse=True)</span>
<span class="s2">        fl = []</span>
<span class="s2">        for us in first_list:</span>
<span class="s2">            fl.append(us)</span>
<span class="s2">        fl.sort(key=lambda x: x.priorizacion, reverse=True)</span>
<span class="s2">        return fl, sl</span>
<span class="s2">#DIVIDER</span>
<span class="s2">    def get(self,request,*args,**kwargs):</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="n">retorna</span> <span class="n">el</span> <span class="n">contexto</span> <span class="n">y</span> <span class="n">permisos</span> <span class="n">de</span> <span class="n">usuario</span> <span class="n">que</span> <span class="n">constituyen</span> <span class="n">la</span> <span class="n">respuesta</span> <span class="n">a</span> <span class="n">las</span>
        <span class="n">consultas</span> <span class="n">GET</span>
        <span class="n">Metodo</span> <span class="n">que</span> <span class="n">es</span> <span class="n">ejecutado</span> <span class="n">al</span> <span class="n">darse</span> <span class="n">una</span> <span class="n">consulta</span> <span class="n">GET</span>
        <span class="p">:</span><span class="n">param</span> <span class="n">request</span><span class="p">:</span> <span class="n">consulta</span> <span class="n">recibida</span>
        <span class="p">:</span><span class="n">param</span> <span class="n">args</span><span class="p">:</span> <span class="n">argumentos</span> <span class="n">adicionales</span>
        <span class="p">:</span><span class="n">param</span> <span class="n">kwargs</span><span class="p">:</span> <span class="n">diccionario</span> <span class="n">de</span> <span class="n">datos</span> <span class="n">adicionales</span>
        <span class="p">:</span><span class="k">return</span><span class="p">:</span> <span class="n">la</span> <span class="n">respuesta</span> <span class="n">a</span> <span class="n">la</span> <span class="n">consulta</span> <span class="n">GET</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-39'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-39'>#</a>
      </div>
      <p>self.object_list = self.get_queryset()
permisos = request.user.get_nombres_permisos(proyecto=self.kwargs[&lsquo;pk_proyecto&rsquo;])
return self.render_to_response(self.get_context_data(permisos=permisos))</p>
<pre><code>def get_context_data(self, *, object_list=None, **kwargs):
</code></pre>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">Metodo</span> <span class="n">que</span> <span class="n">retorna</span> <span class="n">un</span> <span class="n">diccionario</span> <span class="n">utilizado</span> <span class="n">para</span> <span class="n">pasar</span> <span class="n">datos</span> <span class="n">a</span> <span class="n">las</span> <span class="n">vistas</span>
        <span class="p">:</span><span class="n">param</span> <span class="n">kwargs</span><span class="p">:</span> <span class="n">Diccionario</span> <span class="n">de</span> <span class="n">datos</span> <span class="n">adicionales</span> <span class="n">para</span> <span class="n">el</span> <span class="n">contexto</span>
        <span class="p">:</span><span class="k">return</span><span class="p">:</span> <span class="n">diccionario</span> <span class="n">de</span> <span class="n">contexto</span> <span class="n">necesario</span> <span class="n">para</span> <span class="n">la</span> <span class="n">correcta</span> <span class="n">visualizacion</span> <span class="n">de</span> <span class="n">los</span> <span class="n">datos</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-40'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-40'>#</a>
      </div>
      <p>context = super(AsignarUSUpdateView,self).get_context_data(**kwargs)
context[&lsquo;notas&rsquo;] = {}
context[&lsquo;archivos&rsquo;] = {}
context[&lsquo;actividades&rsquo;] = {}
for us in self.object_list:
    context[&lsquo;notas&rsquo;][us.pk] = Nota.objects.filter(us=us.pk)
    context[&lsquo;archivos&rsquo;][us.pk] = Archivo.objects.filter(us=us.pk)
    context[&lsquo;actividades&rsquo;][us.pk] = Actividad.objects.filter(us=us.pk)
context[&ldquo;title&rdquo;] = &ldquo;Asignar User Stories&rdquo;
sprint = Sprint.objects.get(pk=self.kwargs[&lsquo;sprint_pk&rsquo;])
fl, sl = self.get_pendientes_clasificados(sprint)
context[&lsquo;second_list&rsquo;] = sl
context[&lsquo;first_list&rsquo;] = fl
horas = Horas.objects.filter(sprint=sprint.pk)
team_members = []
horas_tm = {}
capacidad = 0
for h in horas:
    team_member = Usuario.objects.get(pk=h.team_member.pk)
    team_members.append(team_member)
    capacidad += h.horas_laborales
context[&lsquo;team_members&rsquo;] = team_members
for tm in team_members:
    if tm.username not in horas_tm.keys():
        horas_dia = Horas.objects.get(sprint=sprint.pk,team_member=tm.pk)
        dias_laborales = sprint.dias_laborales
        horas_tm[tm.pk] = dias_laborales * horas_dia.horas_laborales
context[&lsquo;horas_tm&rsquo;] = horas_tm
context[&lsquo;capacidad_sprint&rsquo;] = capacidad * sprint.dias_laborales
context[&lsquo;proyecto&rsquo;] = Proyecto.objects.get(pk=self.kwargs[&lsquo;pk_proyecto&rsquo;])
context[&lsquo;sprint&rsquo;] = Sprint.objects.get(pk=self.kwargs[&lsquo;sprint_pk&rsquo;])
proyecto = Proyecto.objects.get(pk=self.kwargs[&lsquo;pk_proyecto&rsquo;])
context[&lsquo;direccion&rsquo;] = {}
context[&lsquo;direccion&rsquo;][&lsquo;Ejecuciones&rsquo;] = (1, &lsquo;/proyectos/ejecuciones/&rsquo;)
context[&lsquo;direccion&rsquo;][proyecto.nombre] = (2, &lsquo;/proyectos/ejecuciones/&rsquo; + str(proyecto.pk) + &lsquo;/&rsquo;)
context[&lsquo;direccion&rsquo;][&lsquo;Planificar Sprint: &lsquo;+ context[&lsquo;sprint&rsquo;].nombre] = (3,
    &lsquo;/proyectos/ejecuciones/&rsquo; + str(proyecto.pk) + &lsquo;/sprints/&rsquo;+str(context[&lsquo;sprint&rsquo;].pk)+&rsquo;/asignarus/&rsquo;)
return context</p>
<pre><code>def post(self,request,*args,**kwargs):
</code></pre>
<p>Metodo que valida las asignaciones realizadas por el usuario, de ser validas guarda el user</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">story</span> <span class="n">asignado</span> <span class="n">al</span> <span class="n">sprint</span> <span class="n">pendiente</span><span class="p">,</span> <span class="n">de</span> <span class="n">no</span> <span class="n">ser</span> <span class="n">validas</span> <span class="n">regresa</span> <span class="n">a</span> <span class="n">la</span> <span class="n">vista</span> <span class="n">de</span> <span class="n">asignacion</span>
        <span class="n">para</span> <span class="n">visualizar</span> <span class="n">los</span> <span class="n">errores</span>
        <span class="p">:</span><span class="n">param</span> <span class="n">request</span><span class="p">:</span> <span class="n">consulta</span> <span class="n">recibida</span>
        <span class="p">:</span><span class="n">param</span> <span class="n">args</span><span class="p">:</span> <span class="n">argumentos</span> <span class="n">adicionales</span>
        <span class="p">:</span><span class="n">param</span> <span class="n">kwargs</span><span class="p">:</span> <span class="n">diccionario</span> <span class="n">de</span> <span class="n">datos</span> <span class="n">adicionales</span>
        <span class="p">:</span><span class="k">return</span><span class="p">:</span> <span class="n">la</span> <span class="n">respuesta</span> <span class="n">a</span> <span class="n">la</span> <span class="n">consulta</span> <span class="n">POST</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-41'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-41'>#</a>
      </div>
      <p>self.object_list = self.get_queryset()
permisos = request.user.get_nombres_permisos(proyecto=self.kwargs[&lsquo;pk_proyecto&rsquo;])
asigned = request.POST.getlist(&lsquo;user_stories&rsquo;)
sprint = Sprint.objects.get(pk=self.kwargs[&lsquo;sprint_pk&rsquo;])
for us in self.object_list:
    if str(us.pk) in asigned:
        &lsquo;&rsquo;&lsquo;Se asignan los us al sprint&rsquo;&lsquo;&rsquo;
        us.sprint = sprint
        us.estado = 1  # asignado
        us.fase = Fase.objects.filter(flujo=us.flujo.pk).order_by(&lsquo;pk&rsquo;)[0]
        us.estado_fase = &lsquo;To Do&rsquo;
        asignado_pk = request.POST[&lsquo;team_member_&rsquo; + str(us.pk)]
        asignado = None
        if asignado_pk:
            asignado = Usuario.objects.get(pk=asignado_pk)
        us.team_member = asignado
        us.duracion_estimada = int(request.POST[&lsquo;duracion_estimada_&rsquo; + str(us.pk)])
        try:
            us.validate_asignacion()
            us.save()
        except ValidationError as e:
            error_msg = e.message
            return self.render_to_response(self.get_context_data(permisos=permisos,
                                                                 error_msg=error_msg,
                                                                 set_team_members=True))
    else:
        &lsquo;&rsquo;&lsquo;Se quita la asignacion a todos los us que no fueron seleccionados&rsquo;&lsquo;&rsquo;
        us.duracion_estimada = request.POST[&lsquo;duracion_estimada_&rsquo; + str(us.pk)]
        us.sprint = None
        us.fase = None
        us.estado = 2  # pendiente
        us.estado_fase = &lsquo;To Do&rsquo;
        us.team_member = None
        us.save()
return HttpResponseRedirect(&lsquo;../../../&rsquo;)</p>
<p>@method_decorator(login_required, name=&rsquo;dispatch&rsquo;)
class VerSprintDetailView(LoginRequiredMixin, SuccessMessageMixin, DetailView):</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">Clase</span> <span class="n">de</span> <span class="n">la</span> <span class="n">vista</span> <span class="n">utilizada</span> <span class="n">para</span> <span class="n">visualizar</span> <span class="n">los</span> <span class="n">sprints</span> <span class="n">sin</span> <span class="n">opciones</span> <span class="n">de</span> <span class="n">modificacion</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-42'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-42'>#</a>
      </div>
      <p>model = Sprint
template_name = &lsquo;sprint/ver_sprint.html&rsquo;</p>
<p>def get(self, request, <em>args, </em>*kwargs):</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">Metodo</span> <span class="n">que</span> <span class="n">es</span> <span class="n">ejecutado</span> <span class="n">al</span> <span class="n">darse</span> <span class="n">una</span> <span class="n">consulta</span> <span class="n">GET</span>
        <span class="p">:</span><span class="n">param</span> <span class="n">request</span><span class="p">:</span> <span class="n">consulta</span> <span class="n">recibida</span>
        <span class="p">:</span><span class="n">param</span> <span class="n">args</span><span class="p">:</span> <span class="n">argumentos</span> <span class="n">adicionales</span>
        <span class="p">:</span><span class="n">param</span> <span class="n">kwargs</span><span class="p">:</span> <span class="n">diccionario</span> <span class="n">de</span> <span class="n">datos</span> <span class="n">adicionales</span>
        <span class="p">:</span><span class="k">return</span><span class="p">:</span> <span class="n">la</span> <span class="n">respuesta</span> <span class="n">a</span> <span class="n">la</span> <span class="n">consulta</span> <span class="n">GET</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-43'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-43'>#</a>
      </div>
      <p>self.object = self.get_object()
permisos = request.user.get_nombres_permisos(proyecto=self.kwargs[&lsquo;pk_proyecto&rsquo;])
return self.render_to_response(self.get_context_data(permisos=permisos))</p>
<pre><code>def get_context_data(self, **kwargs):
</code></pre>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">Metodo</span> <span class="n">que</span> <span class="n">retorna</span> <span class="n">un</span> <span class="n">diccionario</span> <span class="n">utilizado</span> <span class="n">para</span> <span class="n">pasar</span> <span class="n">datos</span> <span class="n">a</span> <span class="n">las</span> <span class="n">vistas</span>
        <span class="p">:</span><span class="n">param</span> <span class="n">kwargs</span><span class="p">:</span> <span class="n">Diccionario</span> <span class="n">de</span> <span class="n">datos</span> <span class="n">adicionales</span> <span class="n">para</span> <span class="n">el</span> <span class="n">contexto</span>
        <span class="p">:</span><span class="k">return</span><span class="p">:</span> <span class="n">diccionario</span> <span class="n">de</span> <span class="n">contexto</span> <span class="n">necesario</span> <span class="n">para</span> <span class="n">la</span> <span class="n">correcta</span> <span class="n">visualizacion</span> <span class="n">de</span> <span class="n">los</span> <span class="n">datos</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-44'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-44'>#</a>
      </div>
      <p>context = super().get_context_data(**kwargs)
context[&lsquo;title&rsquo;] = &ldquo;Ver Sprint&rdquo; + str(self.object.pk)
context[&lsquo;project&rsquo;] = Proyecto.objects.get(pk=self.kwargs[&lsquo;pk_proyecto&rsquo;])
all_us = UserStory.objects.filter(sprints_asignados__id=self.object.pk)
context[&lsquo;sprint_backlog&rsquo;] = []
for us in all_us:
    context[&lsquo;sprint_backlog&rsquo;].append(us)
context[&lsquo;sprint_backlog&rsquo;].sort(key=lambda x: x.priorizacion, reverse=True)
context[&lsquo;notas&rsquo;] = {}
context[&lsquo;archivos&rsquo;] = {}
context[&lsquo;actividades&rsquo;] = {}
for us in all_us:
    context[&lsquo;notas&rsquo;][us.pk] = Nota.objects.filter(us=us.pk)
    context[&lsquo;archivos&rsquo;][us.pk] = Archivo.objects.filter(us=us.pk)
    actividades = Actividad.objects.filter(us=us.pk)
    cambios = CambioEstado.objects.filter(us=us.pk)
    context[&lsquo;actividades&rsquo;][us.pk] = []
    for a in actividades:
        a.tipo = &lsquo;actividad&rsquo;
        context[&lsquo;actividades&rsquo;][us.pk].append(a)
    for c in cambios:
        c.tipo = &lsquo;cambio&rsquo;
        context[&lsquo;actividades&rsquo;][us.pk].append(c)
    context[&lsquo;actividades&rsquo;][us.pk].sort(key=lambda x: x.fecha, reverse=True)
context[&lsquo;direccion&rsquo;] = {}
context[&lsquo;direccion&rsquo;][&lsquo;Ejecuciones&rsquo;] = (1, &lsquo;/proyectos/ejecuciones/&rsquo;)
context[&lsquo;direccion&rsquo;][str(context[&lsquo;project&rsquo;])] = (2, &lsquo;/proyectos/ejecuciones/&rsquo; + str(self.kwargs[&lsquo;pk_proyecto&rsquo;]) + &lsquo;/&rsquo;)
context[&lsquo;direccion&rsquo;][&lsquo;Sprints&rsquo;] = (3, &lsquo;/proyectos/ejecuciones/&rsquo; + str(self.kwargs[&lsquo;pk_proyecto&rsquo;]) + &lsquo;/sprints/&rsquo;)
context[&lsquo;direccion&rsquo;][&lsquo;Ver: &lsquo; + self.object.nombre] = (4, &lsquo;/proyectos/ejecuciones/&rsquo; + str(self.kwargs[&lsquo;pk_proyecto&rsquo;]) + &lsquo;/sprints/ver/&rsquo; + str(self.object.pk) + &lsquo;/&rsquo;)
context[&lsquo;dias_habiles&rsquo;] = self.object.get_nombres_dias_habiles()
context[&lsquo;team_members&rsquo;] = Horas.objects.filter(sprint=self.object.pk)
return context</p>
<pre><code>def get_object(self, queryset=None):
</code></pre>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">Metodo</span> <span class="n">que</span> <span class="n">retorna</span> <span class="n">el</span> <span class="n">objeto</span> <span class="n">actual</span>
        <span class="p">:</span><span class="n">param</span> <span class="n">queryset</span><span class="p">:</span>
        <span class="p">:</span><span class="k">return</span><span class="p">:</span> <span class="n">el</span> <span class="n">objeto</span> <span class="n">actual</span>

</pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-45'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-45'>#</a>
      </div>
      <p>sprint = Sprint.objects.get(pk=self.kwargs[&lsquo;pk&rsquo;])
sprint.duracion_real = sprint.get_duracion_real()
return sprint</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
</div>
</body>
